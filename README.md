# HA-3: Syntax Analyzer for Kotlin

> by Rozaliya Amirova and Nikolay Buldakov 

#### Description.
This is a syntax analyzer for the Kotlin programming language. It was generated from [Kotlin EBNF Grammar](https://kotlinlang.org/docs/reference/grammar.html) using [Antlr](http://www.antlr.org). The main functionality of the analyzer is the following: it accepts source code written in Kotlin, parces it and generates a programm tree.

#### How to launch.
*//TODO: write how to launch*

#### Main components.

The project conceptually consists of the following major components:
* __Kotling lexer grammar__ - grammar from which the `Kotlin lexer` is generated.
* __Kotling parser grammar__ - grammar from which the `Kotlin parser` is generated.
* __Kotling lexer__ - lexer for Kotlin generated from grammar. It turns source code into tokens.
* __Kotling parser__ - parser for Kotlin generated from grammar. It buids a `Parce Tree`.
* __Kotling tokens__ - Kotlin tokens generated by `antlr`.
* __JSON Handler__ - converts `Parce Tree` to the JSON representation.
* __Main class__ - puts all other components together.

>Below we provide a more detailed description of some of the components.

#### BNF.

There are two grammars that we use for the project, one is for the lexer, that can be found in `KotlinLexer.g4` and the other is for the parser, in `KotlinParser.g4`. 
The grammaris written in the `EBNF` form for the following reasons:
1. The official Kotlin grammar is presented in EBNF
2. Antlr is able to operate with EBNF notAtion. 

The following resources were used for this part of the projet: [Kotlin Keywords and Operators](http://kotlinlang.org/docs/reference/keyword-reference.html), [Kotlin Grammars and Parsing](http://jetbrains.github.io/kotlin-spec/#_grammars_and_parsing),
[Kotlin Grammar](https://kotlinlang.org/docs/reference/grammar.html) and [Kotlin ANTLR4 grammar](https://github.com/antlr/grammars-v4/tree/master/kotlin)

The grammars themseves can be found in the files mentioned above, They were not included to the document for the sake of a better readability.

#### Antlr4 code generation. 

Once the grammar is defined, it is very easy to generate the `Lexer` and the `Parser` for the defined grammar. 
We used `Intellij Idea` and `Maven` to iclude the `antlr4` library to the project and utilise it for gode generation. We used [step-by-step tutorial how to use Antl4 and Maven for a Java project using Intellij Idea](https://habr.com/post/341138/) to know how to generate the code. As the result the following files were generated:
* `KotlinLexer.java` - implementation of the lexer for Kotlin.
* `KotlinParser.java` - implementation of the parser for Kotlin.
* `KotlinParserBaseListener.java` - automatically generated empty implementation of the listener, which reacts to the tree walker. __Not used in the project__.
* `KotlinParserBaseVisitor.java` - automatically generated empty implementation of the visitor, which handles and directs the tree walking. __Not used in the project__.
* `KotlinLexer.tokens`
* `KotlinParser.tokens`

#### JSON

To generate JSON, we use the `Gson` library, which allows to serialize java objects to JSON. However, it cannot just serialize a `ParceTree` object, that is why we first traverse the tree and recursively build a `HashMap` object where  keys are the values in the nodes and the associated values are the leaves of those.
As a result we get a map, that fully represents the tree and serialize it ti JSON.

#### The Workflow of the program 

`Main.class` assemles all components together and makes them work. Here is the description what it does in particular (can also be seen from the code):
1. Create a `KotlinLexer` object from a `CharStream` of the `in.txt` where the source code is located.
2. Create a `CommonTokenStream` object from `KotlinLexer` object.
3. Create a `ParseTree` object using the  `CommonTokenStream` object. This object represents the tree build from the tokenised source code.
4. Convert the tree to a JSON string, using the `JsonHandler.toJson()` static method.
5. Write the JSON string to `out.txt`
